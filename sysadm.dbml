// NetServa 3.0 - Per-VNode Database Schema
// MariaDB: sysadm database
// SQLite: /var/lib/sqlite/sysadm/sysadm.db

Project sysadm {
  Note: 'Minimal Postfix + Dovecot schema: vhosts, vmails, valias (SQLite or MySQL)'
}

Table vhosts {
  id integer [pk, increment]
  domain text [unique, not null]
  uid integer [not null]
  gid integer [not null]
  active integer [default: 1]
  created_at datetime
  updated_at datetime

  indexes {
    domain [name: 'idx_vhosts_domain']
  }
}

Table vmails {
  id integer [pk, increment]
  user varchar(255) [unique, not null, note: 'Full email address (e.g., admin@domain.com)']
  pass varchar(255) [not null, note: 'Password hash (SHA512-CRYPT, BLF-CRYPT). Query as "pass AS password" for Dovecot']
  home varchar(255) [not null, note: 'Full maildir path (e.g., /srv/domain.com/msg/user)']
  uid integer [not null]
  gid integer [not null]
  quota bigint [default: 500000000, note: 'Mailbox quota in bytes (default 500MB)']
  active integer [default: 1]
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`]

  indexes {
    user [name: 'idx_vmails_user']
  }

  Note: 'Virtual mailboxes - all data in single table, no joins or concatenation required'
}

Table valias {
  id integer [pk, increment]
  source varchar(255) [unique, not null]
  target text [not null]
  active integer [default: 1]
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`]

  indexes {
    source [name: 'idx_valias_source']
  }
}
