// NetServa 3.0 - Per-VNode Database Schema
// MariaDB: sysadm database
// SQLite: /var/lib/sqlite/sysadm/sysadm.db

Project sysadm {
  Note: 'Minimal Postfix + Dovecot schema: vhosts, vmails, valias (SQLite or MySQL)'
}

Table vhosts {
  id integer [pk, increment]
  domain text [unique, not null]
  uid integer [not null]
  gid integer [not null]
  active integer [default: 1]
  created_at datetime
  updated_at datetime

  indexes {
    domain [name: 'idx_vhosts_domain']
  }
}

Table vmails {
  id integer [pk, increment]
  user varchar(255) [unique, not null]
  pass varchar(255) [not null]
  home varchar(255) [not null]
  uid integer [not null]
  gid integer [not null]
  active integer [default: 1]
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`]

  indexes {
    user [name: 'idx_vmails_user']
  }
}

Table valias {
  id integer [pk, increment]
  source varchar(255) [unique, not null]
  target text [not null]
  active integer [default: 1]
  created_at datetime [default: `CURRENT_TIMESTAMP`]
  updated_at datetime [default: `CURRENT_TIMESTAMP`]

  indexes {
    source [name: 'idx_valias_source']
  }
}
